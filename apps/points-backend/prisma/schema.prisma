generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Wallet {
  id          String       @id @default(cuid())
  address     String       @unique
  pointsTotal Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  events      PointEvent[]
  vouchers    Voucher[]
}

model PointEvent {
  id        String   @id @default(cuid())
  wallet    Wallet   @relation(fields: [walletId], references: [id])
  walletId  String
  type      String
  points    Int
  proofRef  String?
  createdAt DateTime @default(now())
}

model Voucher {
  id          String   @id @default(cuid())
  wallet      Wallet   @relation(fields: [walletId], references: [id])
  walletId    String
  nonce       String   @unique
  discountBps Int
  maxUses     Int      @default(1)
  usedCount   Int      @default(0)
  expiresAt   DateTime
  used        Boolean  @default(false)
  createdAt   DateTime @default(now())
}
